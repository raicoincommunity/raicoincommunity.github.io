<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
    <meta name="description" content="" />
    <meta name="author" content="" />
    <title>Online Statistics and Expected Daily Airdrop - Raicoin</title>
    <!-- Favicon-->
    <link rel="icon" type="image/png" href="assets/img/favicon.png" />
    <!-- Font Awesome icons (free version)-->
    <script src="js/fontawesome/v5.13.0/all.js"></script>
    <!-- Google fonts-->
    <link href="https://fonts.googleapis.com/css?family=Montserrat:400,700" rel="stylesheet" type="text/css" />
    <link href="https://fonts.googleapis.com/css?family=Lato:400,700,400italic,700italic" rel="stylesheet"
        type="text/css" />
    <!-- Core theme CSS (includes Bootstrap)-->
    <link href="css/styles.css" rel="stylesheet" />
</head>

<body id="page-top">
    <!-- Navigation-->
    <nav class="navbar navbar-expand-lg bg-secondary text-uppercase fixed-top" id="mainNav">
        <div class="container">
            <a class="navbar-brand js-scroll-trigger" href="./index.html">Raicoin</a>
            <button
                class="navbar-toggler navbar-toggler-right text-uppercase font-weight-bold bg-primary text-white rounded"
                type="button" data-toggle="collapse" data-target="#navbarResponsive" aria-controls="navbarResponsive"
                aria-expanded="false" aria-label="Toggle navigation">
                Menu
                <i class="fas fa-bars"></i>
            </button>
            <div class="collapse navbar-collapse" id="navbarResponsive">
              <ul class="navbar-nav ml-auto">
                <li class="nav-item mx-0 mx-lg-1"><a class="nav-link py-3 px-0 px-lg-3 rounded js-scroll-trigger"
                        href="https://raiwallet.org/" target="_blank">Wallet</a></li>
                <li class="nav-item mx-0 mx-lg-1"><a class="nav-link py-3 px-0 px-lg-3 rounded js-scroll-trigger"
                        href="./index.html#explorer">Explorer</a></li>
                <li class="nav-item mx-0 mx-lg-1"><a class="nav-link py-3 px-0 px-lg-3 rounded js-scroll-trigger"
                        href="https://pancakeswap.info/token/0x64EF755D5A2627538CAA3Eb62ee07f96f9B608E4" target="_blank">Exchange</a></li>
                <li class="nav-item mx-0 mx-lg-1"><a class="nav-link py-3 px-0 px-lg-3 rounded js-scroll-trigger"
                        href="./index.html#resource">Resource</a></li>
                <li class="nav-item mx-0 mx-lg-1"><a class="nav-link py-3 px-0 px-lg-3 rounded js-scroll-trigger"
                        href="./index.html#software">Software</a></li>
                
                <li class="nav-item mx-0 mx-lg-1"><a class="nav-link py-3 px-0 px-lg-3 rounded js-scroll-trigger"
                        href="nodes.html">Nodes</a></li>
            </ul>
        </div>
        </div>
    </nav>
    <!-- Airdrop Section-->
    <section class="page-section">
        <div class="text-center mt-5" id="load">
            <div class="spinner-border" role="status">
                <span class="sr-only">Loading...</span>
            </div>
        </div>

        <div class="text-center mt-5">
          <p id="error" class="d-none"></p>
        </div>
    
       <div class="container mt-3 d-none" id="airdrops">
            <table class="table table-striped" >
              <thead>
                <tr>
                    <th scope="col">#</th>
                    <th scope="col">Representative Account</th>
                    <th scope="col">
                        <div data-toggle="tooltip" data-placement="right" title="Airdrop is based on counted online days, it's updated at 00:00:00 UTC everyday">Online Days (counted)</div>
                    </th>
                    <th scope="col">Online Days (real time)</th>
                    <th scope="col">
                        <div data-toggle="tooltip" data-placement="right" title="If qualified for today's airdrop">Airdrop Qualified</div>
                    </th>
                    <th scope="col">
                        <div data-toggle="tooltip" data-placement="right" title="Release with average 24 hours delay">Expected Daily Airdrop</div>
                    </th>
                </tr>
              </thead>
              <tbody>
              </tbody>
            </table>
        </div>
    </section>

    <!-- Footer-->
    <footer class="footer text-center">
        <div class="container">
            <div class="row">
                <!-- Footer Social Icons-->
                <div class="col-lg-6 mb-5 mb-lg-0">
                    <h4 class="text-uppercase mb-4">Follow us</h4>
                    <a class="btn btn-outline-light btn-social mx-1" href="https://t.me/RaicoinOfficial"><i
                      class="fab fa-fw fa-telegram-plane"></i></a>
                    <a class="btn btn-outline-light btn-social mx-1" href="https://twitter.com/RaicoinC"><i
                        class="fab fa-fw fa-twitter"></i></a>
                <a class="btn btn-outline-light btn-social mx-1" href="https://github.com/raicoincommunity"><i class="fab fa-fw fa-github"></i></a>
                    <a class="btn btn-outline-light btn-social mx-1" href="https://bitcointalk.org/index.php?topic=5188094.0"><i class="fab fa-fw fa-dribbble"></i></a>
          </div>
                <!-- Footer About Text-->
                <div class="col-lg-6">
                    <h4 class="text-uppercase mb-4">About</h4>
                    <p class="lead mb-0">
                        Raicoin is a  MIT licensed opensource project.
                    </p>
                </div>
            </div>
        </div>
    </footer>
    <!-- Copyright Section-->
    <div class="copyright py-4 text-center text-white">
        <div class="container"><small>Copyright Â© Raicoin Community 2020</small></div>
    </div>
    <!-- Scroll to Top Button (Only visible on small and extra-small screen sizes)-->
    <div class="scroll-to-top d-lg-none position-fixed">
        <a class="js-scroll-trigger d-block text-center text-white rounded" href="#page-top"><i
                class="fa fa-chevron-up"></i></a>
    </div>

    <!-- Bootstrap core JS-->
    <script src="js/jquery/3.5.1/jquery.min.js"></script>
    <script src="js/bootstrap/4.5.0/bootstrap.bundle.min.js"></script>
    <!-- Third party plugin JS-->
    <script src="js/jquery-easing/1.4.1/jquery.easing.min.js"></script>
    <!-- Core theme JS-->
    <script src="js/scripts.js"></script>
    <script src="js/util.js"></script>
    <script src="js/search.js"></script>
    <script>
        $(function(){
          var error = false;
          var daily_airdrop = 0;
          var counted_total = 0;
          var stats_today = null;
          var stats_yesterday = null;
          var stats_before_yesterday = null;
          var invited_reps = null;
          var online_reps = null;
          var api = "https://airdrop.raicoin.org/stat/cumulative/";

          var mergeData = function(){
            var result = {};
            for (var i = 0; i < stats_today.length; ++i)
            {
                var v = stats_today[i];
                if (!(v['rep'] in result))
                {
                    result[v['rep']] = {'today': 0, 'yesterday': 0, 'before_yesterday': 0, 'rep': v['rep']}
                }
                result[v['rep']]['today'] = v['count'];
            }

            for (var i = 0; i < stats_yesterday.length; ++i)
            {
                var v = stats_yesterday[i];
                if (!(v['rep'] in result))
                {
                    result[v['rep']] = {'today': 0, 'yesterday': 0, 'before_yesterday': 0, 'rep': v['rep']}
                }
                result[v['rep']]['yesterday'] = v['count'];
            }

            for (var i = 0; i < stats_before_yesterday.length; ++i)
            {
                var v = stats_before_yesterday[i];
                if (!(v['rep'] in result))
                {
                    result[v['rep']] = {'today': 0, 'yesterday': 0, 'before_yesterday': 0, 'rep': v['rep']}
                }
                result[v['rep']]['before_yesterday'] = v['count'];
            }

            result = Object.values(result);
            result.sort(function (a, b){
                return b['today'] - a['today'];
            });
            return result;
          };

          var toLink = function(item){
            var value = item['rep'];
            if (repOnline(item))
            {
              return '<a href="./explorer.html?search=' + value + '">' + value + '</a>';
            }
            else
            {
              return '<a href="./explorer.html?search=' + value + '" class="text-muted">' + value + '</a>';
            }
          };

          var toDays = function(value){
            return (value / 288).toFixed(2);
          };

          var toQualified = function(item) {
            if (qualified(item))
            {
                return '<span class="badge badge-pill badge-success">YES</span>';
            }
            else
            {
                return '<span class="badge badge-pill badge-danger">NO</span>';
            }
          };

          var toExpected = function(item) {
            if (!qualified(item) || counted_total == 0)
            {
                return '';
            }

            if (daily_airdrop == 0)
            {
                return '0 RAI';
            }

            return (item['yesterday'] * daily_airdrop / counted_total).toFixed() + ' RAI';
          };

          var repOnline = function(item)
          {
            return online_reps.indexOf(item['rep']) > -1;
          };

          var toIndex = function(index, item)
          {
            if (repOnline(item))
            {
              return '' + index;
            }
            else
            {
              return '*' + index;
            }
          }

          var row = function(index, item){
            return '<tr>' +
              '<td>' + toIndex(index, item) + '</td>' +
              '<td style="font-family: Consolas">' + toLink(item) + '</td>' +
              '<td>' + toDays(item['yesterday']) + '</td>' +
              '<td>' + toDays(item['today']) + '</td>' +
              '<td>' + toQualified(item) + '</td>' +
              '<td>' + toExpected(item) + '</td>' +
              '</tr>';
          };

          var qualified = function(item) {
            if (item['yesterday'] == item['before_yesterday'] || item['yesterday'] == 0)
            {
                return false;
            }

            if (daily_airdrop <= 32000)
            {
                return true;
            }
            
            if (item['rep'] in invited_reps)
            {
                return true;
            }

            return false;
          };

          var countedTotal = function(merged) {
            var total = 0;
            for (var i = 0; i < merged.length; ++i)
            {
              if (qualified(merged[i]))
              {
                  total += merged[i]['yesterday'];
              }
            }
            return total;
          };

          var processSuccess = function(){
            if (error) return;
            if (stats_today === null || stats_yesterday === null || stats_before_yesterday === null || invited_reps === null || online_reps === null)
            {
                return;
            }

            var data = mergeData();
            counted_total = countedTotal(data);

            var tbody = $('#airdrops tbody');
            for (var i = 0; i < data.length; ++i)
            {
              tbody.append(row(i + 1, data[i]));
            }

            $('#load').hide();
            $('#airdrops').removeClass('d-none');
          };

          var processError = function(data){
            if (error) return;
            if (data['status'] != 'success')
            {
              error = true;
              $('#load').hide();
              $('#error').text(data['reason']).removeClass("d-none");
              return;
            }
          };

          var parseStatsToday = function(data){
            processError(data);
            if (error) return;

            daily_airdrop = data['daily_airdrop'];
            stats_today = data['records'];
            processSuccess();
          };

          var parseStatsYesterday = function(data){
            processError(data);
            if (error) return;

            stats_yesterday = data['records'];
            processSuccess();
          };

          var parseStatsBeforeYesterday = function(data){
            processError(data);
            if (error) return;

            stats_before_yesterday = data['records'];
            processSuccess();
          };

          var parseInvitedReps = function(data) {
            var invited = {};
            var reps = data['representatives'];
            for (var i = 0; i < reps.length; ++i)
            {
                invited[reps[i]['account']] = reps[i]['description'];
            }
            invited_reps = invited;
            processSuccess();
          };

          var parseOnlineReps = function(data) {
            var onlines = [];
            var reps = data['peers'];
            for (var i = 0; i < reps.length; ++i)
            {
                onlines.push(reps[i]['account']);
            }
            online_reps = onlines;
            processSuccess();
          }

          var errorProcess = function(errMsg){
            $('#load').hide();
            $('#error').text("Error: failed to connect api server").removeClass("d-none");
          };

          $.ajax({
              type: "GET",
              url: api + "?day=today&d=xxx",
              contentType: "application/json; charset=utf-8",
              dataType: "json",
              success: parseStatsToday,
              failure: errorProcess
            });

            $.ajax({
              type: "GET",
              url: api + "?day=yesterday",
              contentType: "application/json; charset=utf-8",
              dataType: "json",
              success: parseStatsYesterday,
              failure: errorProcess
            });

            $.ajax({
              type: "GET",
              url: api + "?day=before_yesterday",
              contentType: "application/json; charset=utf-8",
              dataType: "json",
              success: parseStatsBeforeYesterday,
              failure: errorProcess
            });

            $.ajax({
              type: "GET",
              url: "https://airdrop.raicoin.org/invited/",
              contentType: "application/json; charset=utf-8",
              dataType: "json",
              success: parseInvitedReps,
              failure: errorProcess
            });

            $.ajax({
              type: "POST",
              url: "https://rpc.raicoin.org/",
              data: JSON.stringify({ 'action': 'peers'}),
              contentType: "application/json; charset=utf-8",
              dataType: "json",
              success: parseOnlineReps,
              failure: errorProcess
            });


      }); 
    </script>
</body>

</html>